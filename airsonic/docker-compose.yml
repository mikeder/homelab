version: '3'
services:
  airsonic:
    container_name: airsonic
    image: airsonicadvanced/airsonic-advanced:latest
    user: 1000:1000
    restart: unless-stopped
    networks:
      - proxy
    environment:
      PUID: 1000
      PGID: 1000
      CONTEXT_PATH: /
      JAVA_OPTS: -Dserver.use-forward-headers=true -Dserver.forward-headers-strategy=native -Dserver.context-path=/
    labels:
      - traefik.enable=true
      - traefik.http.routers.airsonic.rule=Host(`airsonic.sqweeb.net`)
      - traefik.http.routers.airsonic.service=airsonic-http
      - traefik.http.routers.airsonic.middlewares=redirect-https # redirect http to https
      - traefik.http.routers.airsonic-secure.tls=true
      - traefik.http.routers.airsonic-secure.tls.certresolver=letsencrypt
      - traefik.http.routers.airsonic-secure.rule=Host(`airsonic.sqweeb.net`)
      - traefik.http.routers.airsonic-secure.service=airsonic-http
      - traefik.udp.routers.airsonic-upnp.rule=Host(`airsonic.sqweeb.net`)
      - traefik.udp.routers.airsonic-upnp.service=airsonic-upnp
      - traefik.udp.routers.airsonic-upnp.entrypoints=upnp
      - traefik.http.services.airsonic-http.loadbalancer.server.port=4040
      - traefik.udp.services.airsonic-upnp.loadbalancer.server.port=1900
    volumes:
      - /mnt/music:/var/music
      - /home/meder/homelab/airsonic/data:/var/airsonic
      - /home/meder/homelab/airsonic/playlists:/var/playlists
      - /home/meder/homelab/airsonic/podcasts:/var/podcasts
networks:
  proxy:
    external: true
